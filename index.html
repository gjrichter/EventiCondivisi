<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="iso-8957">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="assets/img/favicon.png">

    <title>Matera Open Data Contest</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="assets/css/main.css" rel="stylesheet">

    <!-- Fonts from Google Fonts -->
	<link href='http://fonts.googleapis.com/css?family=Lato:300,400,900' rel='stylesheet' type='text/css'>
 
	<!-- styles --> 
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />

	<style rel="stylesheet">
		.leaflet-container label{
			font-family: 'Lato', sans-serif;
			font-weight: 300;
			font-size: 13px;
			color: #555;
			line-height: 1em;
			margin:0;
			padding:0;

		}
		code {
			text-align:left;
			color: #000;
			background: #eee;
			font-size: 0.9em;
			white-space: pre;
			display: block;
			padding: 8px;
			border: 1px dashed #ccc;
			margin-bottom: 15px;
			overflow: hidden;
		}

	</style>

	<link media="screen" href="css/anyfeedmap.css" rel="stylesheet" type="text/css" />
	<link media="print" href="css/anyfeedmap_print.css" rel="stylesheet" type="text/css" />

	<link media="screen" href="css/tooltip.css" rel="stylesheet" type="text/css" />
	<link media="screen" href="css/messagebox.css" rel="stylesheet" type="text/css" />
	<link media="screen" href="css/idtab.css" rel="stylesheet" type="text/css" /> 
	<link media="screen" href="css/form.css" rel="stylesheet" type="text/css" /> 
	<link media="print" href="css/idtab_print.css" rel="stylesheet" type="text/css" /> 

	<link media="screen" href="css/layerlist.css" rel="stylesheet" type="text/css" /> 
	<link media="screen" href="css/date.css" rel="stylesheet" type="text/css" /> 

	<!--[if lte IE 8]>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.ie.css" />
	<![endif]-->

	<!-- scripts --> 

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#"><b>per il contest: 'Open-Matera'</b></a>
        </div>
        <div class="navbar-collapse collapse">
        </div><!--/.nav-collapse -->
      </div>
    </div>

	<div id="headerwrap" >
		<div class="container">
			<div class="row">
				<div class="col-lg-6">
					<h1>Eventi Condivisi<br/>
					ed altro</h1>
					<span style="color:#fff">
					'Eventi Condivisi ed altro' e un'applicazione , per visualizzare vari dataset del Comune di Matera, a partire del dataset 'eventi condivisi', su una mappa.<br><br>
					L'applicazione è 'mobile first', usufruibile su PC, tablet e smartphone, è realizzato con vari framework ed API in javascript: MapTune, mapstraction, leaflet, bootstrap, jquery e jquery mobile</span>
					<br><br>
					<span style="color:#FDAC38">
					Ci sono due interfaccia utente, principalmente usufruibile su tutti dispositivi, ma differente nel uso dello spazio e nell'offerta degli strumenti
					</span>
					<br><br>
					<a href="./anyfeedmap_flat.html?mode=noinfo&param=BasilicataEventi.js">
					  <button class="btn btn-warning btn-lg" >Desktop</button>
					</a>
					<a href="./maptune_mapstraction.html?mode=noinfo&param=BasilicataEventi.js">
					  <button class="btn btn-warning btn-lg" >Mobile</button>
					</a>
					<p></p>
				</div><!-- /col-lg-6 -->
				<div class="col-lg-6" style="display:none">
					<img class="img-responsive" src="assets/img/ipad-hand.png" alt="">
				</div><!-- /col-lg-6 -->
				
			</div><!-- /row -->
		</div><!-- /container -->
	</div><!-- /headerwrap -->

	
	<div id="info" class="container">
		<div class="row mt ">
			<div class="col-lg-8 col-md-9 col-xs-12">
		<p>Link alla sorgente di MapTune: <a href="https://github.com/gjrichter/maptune">https://github.com/gjrichter/maptune</a><br>
		   Link alla sorgente dell'applicazione: <a href="https://github.com/gjrichter/EventiCondivisi">https://github.com/gjrichter/EventiCondivisi</a></p>

		<hr>

		<h3>informazioni tecniche per 'smanettoni'</h3>

		<p>MapTune è un Framework in Javascript per visualizzare geo data feed di vari formati.
		MapTune può interpretare vari formati geodata 'standard' tra i quali KML, geoJson e GeoRSS ma 
		anche tabelle georeferenziate in CSV. Inoltre il parser di MapTune è estendibile via plugin, e cosi adattabile a nuovi o proprietari formati, basta che si basino su XML o JSON.</p>
		<p>Per caricare un dataset sulla mappa di MapTune, si definisce una descrizione della fonte dei dati e della rappresentazione sia per la mappa che per la lista.
		Questa descrizione è un semplice oggetto in JSON. Di seguito quella per gli 'Eventi condivisi' usata per questa applicazione:</p>
		<code>
maptune.addFeedLayer('http://goo.gl/Fo9jnt',{
  type:  'csv',
  format:'csv',
  flag:  'closed|noinfo|zoomto',
  title: 'Eventi Condivisi',
  parser: {
    lat:       'lat',
    lon:       'lng',
    timeStart: 'Data inizio',
    timeEnd:   'Data fine',
    timeParse: function(value){var dateA = value.split(' ')[0].split('\/');return new Date(dateA[2],dateA[1]-1,dateA[0]);},
    label:     'true',
    info:      'Organizzatore|Note|Pagamento|Tipologia|Data inizio|Data fine|Luogo|Link|Email_contatto|Link_immagine ',
    image:     'Link_immagine'   
    },
  layer:{ 
    name:        'Eventi Condivisi',
    description: 'Eventi OpenData in collaborazione con Comitato Matera 2019 Mappa ... ',
    markerType : 'categorical',
    sort       : 'timeUp',      
    category   : 'Tipologia', 
    categoryList: { 
      Musica    : { 'markerImage' : 'resources/icons/map-icons-collection/music_classical.png',
                    'smallImage' :  'resources/icons/default/default-small_violet.png'
                  },
      Teatro    : { 'markerImage' : 'resources/icons/map-icons-collection/theater.png',
                    'smallImage' : 'resources/icons/default/default-small_violet.png'
                  },
      Danza     : { 'markerImage' : 'resources/icons/map-icons-collection/theater.png',
                    'smallImage' : 'resources/icons/default/default-small_violet.png'
                  },
      Sport     : { 'markerImage' : 'resources/icons/map-icons-collection/indoor-arena.png',
                    'smallImage' : 'resources/icons/default/default-small_orange.png'
                  },
      Mostre    : { 'markerImage' : 'resources/icons/map-icons-collection/museum_art.png',
                    'smallImage' : 'resources/icons/default/default-small_violet.png'
                  },
      Cinema    : { 'markerImage' : 'resources/icons/map-icons-collection/cinema.png',
                    'smallImage' : 'resources/icons/default/default-small_violet.png'
                  },
      Tradizione: { 'markerImage' : 'resources/icons/map-icons-collection/farmstand.png',
                    'smallImage' : 'resources/icons/default/default-small_violet.png'
                  },
      'Altri eventi':
                  { 'markerImage' : 'resources/icons/map-icons-collection/departmentstore.png',
                    'smallImage' : 'resources/icons/default/default-small_red.png'
                  }
	  },
    markerImage : 'resources/icons/default/default_red.png',
    smallImage : 'resources/icons/default/default-small_red.png',
    markerImageType : 'png',
    initialTimeScope:'all',
    },

flag:'zoomto'});
}
		</code>
		<br>		
		<p>Come si può notare, non è solo l'oggetto JSON, ma anche la 'function call' in Javascript per aggiungere la nuova fonte alla mappa. Il primo argomento:</p>
		<code>
'http://goo.gl/Fo9jnt'
		</code>
		<p>definisce la sorgente dei dati, in questo caso un link ad un 'Google Spreadsheet', che contiene gli 'eventi condivisi'. Il link porta ad avere un documento in CSV</p>
		<p>Il 'parser':</p> 
		<code>
parser: {
lat:       'lat',
lon:       'lng',
timeStart: 'Data inizio',
timeEnd:   'Data fine',
timeParse: function(value){var dateA = value.split(' ')[0].split('\/');return new Date(dateA[2],dateA[1]-1,dateA[0]);},
label:     'true',
info:      'Organizzatore|Note|Pagamento|Tipologia|Data inizio|Data fine|Luogo|Link|Email_contatto|Link_immagine ',
image:     'Link_immagine'   
},
		</code>
		<p>definisce i campi della tabella in CSV dove si trovano: la posizione (lat,lon) dell'evento, la data di inizio e fine dell'evento, ed i campi da presentare nella lista o sulla mappa.</p> 
		<p>l'oggetto 'layer':</p> 
		<code>
layer:{ 
name:        'Eventi Condivisi',
description: 'Eventi OpenData in collaborazione con Comitato Matera 2019 Mappa ... ',
markerType : 'categorical',
sort       : 'timeUp',      
category   : 'Tipologia', 
categoryList: { 
  Musica    : { 'markerImage' : 'resources/icons/map-icons-collection/music_classical.png',
				'smallImage' :  'resources/icons/default/default-small_violet.png'
			  },
  Teatro    : { 'markerImage' : 'resources/icons/map-icons-collection/theater.png',
				'smallImage' : 'resources/icons/default/default-small_violet.png'
			  },
  Danza     : { 'markerImage' : 'resources/icons/map-icons-collection/theater.png',
				'smallImage' : 'resources/icons/default/default-small_violet.png'
			  },
  Sport     : { 'markerImage' : 'resources/icons/map-icons-collection/indoor-arena.png',
				'smallImage' : 'resources/icons/default/default-small_orange.png'
			  },
  Mostre    : { 'markerImage' : 'resources/icons/map-icons-collection/museum_art.png',
				'smallImage' : 'resources/icons/default/default-small_violet.png'
			  },
  Cinema    : { 'markerImage' : 'resources/icons/map-icons-collection/cinema.png',
				'smallImage' : 'resources/icons/default/default-small_violet.png'
			  },
  Tradizione: { 'markerImage' : 'resources/icons/map-icons-collection/farmstand.png',
				'smallImage' : 'resources/icons/default/default-small_violet.png'
			  },
  'Altri eventi':
			  { 'markerImage' : 'resources/icons/map-icons-collection/departmentstore.png',
				'smallImage' : 'resources/icons/default/default-small_red.png'
			  }
  },
		</code>
		<p>definisce la rappresentazione categorizzata degli elementi sulla mappa</p>
		<h3>parser plugin per 'MateraPulita'</h3>
		<p>Nella lista dei sorgenti 'Open Data' da aggiungere alla mappa, si trova anche un feed in XML proprietario, 'http://www.materapulita.it/app/segnalazioniopen.xml',
		che richiede un plugin per il parser di MapTune. Il plugin viene definito in un file Javascript con il nome 'map_feed.parse.MateraPulita.js' e riferito nella configurazione del feed come parametro 'type':'MateraPulita', quindi con lo stesso nome del parser plugin.
		</p>
		<code>
...
&lt;a href="javascript:maptune.addFeedLayer('http://www.materapulita.it/app/segnalazioniopen.xml',{
  type:'<span style="color:#2244dd">MateraPulita</span>',
  format:'xml',
  flag:'open|showinfo|zoomto',
  title:'MateraPulita'
 });" &gt:MateraPulita (xml)&lt;/a&gt;
...
		</code>
		<p style="margin-bottom:10px;">Il plugin deve definiere il parser propriertario più o meno cosi: </p>
		<code>
window.ixmaps = window.ixmaps || {};
ixmaps.feed = ixmaps.feed || {};
ixmaps.feed.parse = ixmaps.feed.parse || {};
(function() {

/**
 * parse the feed data and make an ixmaps layer object  
 * @param the data object received from the feed
 * @param opt optional parameter object
 * @type object
 * @return an ixmaps layer object
 */
  ixmaps.feed.parse.<span style="color:#2244dd">MateraPulita</span> = function(data,opt){
    if ( opt.format == "json" ) {
        ...

        <span style="color:#228844">// define at least one layer</span>

        var <span style="color:#2244dd">layerset</span> = new ixmaps.feed.LayerSet(title);
            layer    = layerset.addLayer(title);

        <span style="color:#228844">// define the features</span>

        var feature  = layer.addFeature(szTitle);
            feature.setPosition(pointA[1],pointA[0]);

        ...

        return <span style="color:#2244dd">layerset</span>;
    }
    return null;
  };
})();

		</code>
		<p>Non aggiungo altro alla descrizione, ma per qualsiasi domanda sono a disposizione su:
		guenter.richter@gmail.com</p>

		<p>Link alla sorgente di MapTune: <a href="https://github.com/gjrichter/maptune">https://github.com/gjrichter/maptune</a><br>
		   Link alla sorgente dell'applicazione: <a href="https://github.com/gjrichter/EventiCondivisi">https://github.com/gjrichter/EventiCondivisi</a></p>
	</div>
	</span>

<!-- fine container -->
</div>
</div>
</div>
</div>
	
	<div class="container">
		<hr>
		<div class="row">
			<div class="col-lg-6 col-lg-offset-3">
			Credits:<br>
			sorgente dei dati: <a href="http://dati.comune.matera.it/">Portale Dati aperti del Comune di Matera</a><br>
			Mapstraction: <a href="http://mapstraction.com"</a>mapstraction.com</a><br>
			Leaflet: <a href="http://leafletjs.com">leafletjs.com</a><br>
			mapicons:  <a href="http://mapicons.nicolasmollet.com">mapicons.nicolasmollet.com</a><br>
			bootstrap: <a href="http://getbootstrap.com/">getbootstrap.com</a> glyphicons: <a href="http://glyphicons.com"</a>glyphicons.com</a><br>
			bootstrap template by BlackTie.co - Attribution License 3.0 - 2013<br>
			</div>
			<div class="col-lg-3"></div>
		</div><!-- /row -->
		<hr>
	</div><!-- /container -->
	


  </body>
</html>
